{{- $url := .Destination | safeURL -}}
{{- $block := gt (len .Title) 0 -}}

{{- if $block -}}
<span class="image-container"><span class="link">
{{- end -}}

{{- if site.Params.cdn -}}
<img {{ if $block }}class="img"{{ end }} src="{{- (print site.Params.cdn $url) -}}"
        alt{{- with .Text -}}="{{- . -}}" {{- end -}} />
{{- else -}}
<img {{ if $block }}class="img"{{ end }} src="{{- $url -}}"
     alt{{- with .Text -}}="{{- . -}}" {{- end -}} />
{{- end -}}

{{- if $block -}}
</span>
  {{- if ne .Title " " -}}
    <span class="caption"><span class="title">{{- .Title | safeHTML -}}</span></span>
  {{- end -}}
</span>
{{- end -}}